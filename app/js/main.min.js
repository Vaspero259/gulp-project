document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("home"),t=e.querySelectorAll(".banner-text > div"),o=e.querySelectorAll(".banner-subtext > div"),r=e.querySelectorAll("picture");let d=0;const a=t.length;function c(e){t.forEach(((t,o)=>t.classList.toggle("active",o===e))),o.forEach(((t,o)=>t.classList.toggle("active",o===e))),r.forEach(((t,o)=>{o===e?t.classList.add("active"):t.classList.remove("active")}))}setInterval((()=>{d=(d+1)%a,c(d)}),8e3),c(d)}));const productModal=document.getElementById("product-modal"),closeProductModal=document.getElementById("close-product-modal"),productModalImg=document.getElementById("product-modal-img"),productModalTitle=document.getElementById("product-modal-title"),productModalDesc=document.getElementById("product-modal-desc"),productModalPrice=document.getElementById("product-modal-price"),productModalQty=document.getElementById("product-modal-qty"),addToCartForm=document.getElementById("add-to-cart-form");function openProductModal(e){productModalImg.src=e.dataset.img,productModalImg.alt=e.dataset.title,productModalTitle.textContent=e.dataset.title,productModalDesc.textContent=e.dataset.desc,productModalPrice.textContent=e.dataset.price+" ₽",productModalQty.value=1,productModal.dataset.id=e.dataset.id,productModal.dataset.title=e.dataset.title,productModal.dataset.price=e.dataset.price,productModal.dataset.img=e.dataset.img,productModal.dataset.desc=e.dataset.desc,productModal.dataset.category=e.dataset.category,productModal.classList.add("active"),document.body.style.overflow="hidden",setTimeout((()=>{productModalQty.focus()}),100)}function saveCart(){localStorage.setItem("cart",JSON.stringify(window.cart))}function loadCart(){try{window.cart=JSON.parse(localStorage.getItem("cart"))||[]}catch{window.cart=[]}updateCartUI()}function showToast(e){const t=document.getElementById("cart-toast");t.textContent=e,t.style.display="block",t.style.animation="fadeToast 2s linear",setTimeout((()=>{t.style.display="none",t.style.animation=""}),2e3)}function updateCartUI(){const e=document.getElementById("cart-items-list"),t=document.getElementById("cart-total"),o=document.querySelector('#cart-filter input[name="cart-filter"]:checked').value;e.innerHTML="";let r=0,d=window.cart;if("all"!==o&&(d=window.cart.filter((e=>e.category===o))),0===d.length)return e.innerHTML='<li style="text-align:center; color:#aaa;">Нет товаров в этой категории</li>',t.textContent="",void(document.getElementById("checkout-btn").disabled=!0);d.forEach((t=>{r+=t.price*t.qty;const o=document.createElement("li");o.innerHTML=`\n      <div>${t.title} × ${t.qty}</div>\n      <div>\n        <span>${t.price*t.qty} ₽</span>\n        <button class="remove-item" title="Удалить" data-id="${t.id}">&times;</button>\n      </div>\n    `,e.appendChild(o)})),t.textContent="Итого: "+r+" ₽",document.getElementById("checkout-btn").disabled=0===window.cart.length,e.querySelectorAll(".remove-item").forEach((e=>{e.onclick=function(){const e=this.dataset.id;window.cart=window.cart.filter((t=>t.id!==e)),saveCart(),updateCartUI()}}))}closeProductModal.onclick=()=>{productModal.classList.remove("active"),document.body.style.overflow=""},productModal.onclick=e=>{e.target===productModal&&(productModal.classList.remove("active"),document.body.style.overflow="")},document.querySelectorAll(".item").forEach((e=>{e.addEventListener("click",(()=>openProductModal(e))),e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||openProductModal(e)}))})),window.cart=[],addToCartForm.onsubmit=function(e){e.preventDefault();const t=productModal.dataset.id,o=productModal.dataset.title,r=Number(productModal.dataset.price),d=productModal.dataset.img,a=productModal.dataset.desc,c=Math.max(1,parseInt(productModalQty.value,10)||1),n=productModal.dataset.category;let l=!1;for(let e of window.cart)if(e.id===t){e.qty+=c,l=!0;break}l||window.cart.push({id:t,title:o,price:r,img:d,desc:a,qty:c,category:n}),saveCart(),productModal.classList.remove("active"),document.body.style.overflow="",showToast("Товар добавлен в корзину!"),updateCartUI()},document.getElementById("open-cart-btn").onclick=function(){document.getElementById("cart-modal").classList.add("active"),document.body.style.overflow="hidden",updateCartUI()},document.getElementById("close-cart-btn").onclick=function(){document.getElementById("cart-modal").classList.remove("active"),document.body.style.overflow=""},document.getElementById("cart-modal").onclick=function(e){e.target===this&&(this.classList.remove("active"),document.body.style.overflow="")},document.getElementById("clear-cart").onclick=function(){window.cart=[],saveCart(),updateCartUI()},document.querySelectorAll('#cart-filter input[name="cart-filter"]').forEach((e=>{e.addEventListener("change",updateCartUI)}));const orderFormModal=document.getElementById("order-form-modal"),closeOrderForm=document.getElementById("close-order-form"),orderForm=document.getElementById("order-form"),orderName=document.getElementById("order-name"),orderPhone=document.getElementById("order-phone"),orderAddress=document.getElementById("order-address"),orderNameError=document.getElementById("order-name-error"),orderPhoneError=document.getElementById("order-phone-error"),orderAddressError=document.getElementById("order-address-error"),orderSuccess=document.getElementById("order-success"),orderFormTotal=document.querySelector(".order-form-total");function saveOrderForm(){localStorage.setItem("orderForm",JSON.stringify({name:orderName.value,phone:orderPhone.value,address:orderAddress.value}))}function loadOrderForm(){try{const e=JSON.parse(localStorage.getItem("orderForm"));e&&(orderName.value=e.name||"",orderPhone.value=e.phone||"",orderAddress.value=e.address||"")}catch{}}document.getElementById("checkout-btn").onclick=function(){orderFormTotal.textContent=document.getElementById("cart-total").textContent,orderFormModal.classList.add("active"),document.body.style.overflow="hidden",orderSuccess.textContent="",loadOrderForm()},closeOrderForm.onclick=()=>{orderFormModal.classList.remove("active"),document.body.style.overflow=""},orderFormModal.onclick=e=>{e.target===orderFormModal&&(orderFormModal.classList.remove("active"),document.body.style.overflow="")},orderForm.onsubmit=function(e){e.preventDefault();let t=!0;orderNameError.textContent="",orderPhoneError.textContent="",orderAddressError.textContent="",orderSuccess.textContent="",orderName.value.trim().length<2&&(orderNameError.textContent="Введите имя (минимум 2 буквы)",t=!1),/^(\+7|8)[0-9]{10}$/.test(orderPhone.value.trim())||(orderPhoneError.textContent="Введите телефон в формате +79991234567 или 89991234567",t=!1),orderAddress.value.trim().length<5&&(orderAddressError.textContent="Введите адрес доставки",t=!1),t&&(saveOrderForm(),orderSuccess.textContent="Заказ успешно оформлен! Спасибо!",window.cart=[],saveCart(),updateCartUI(),setTimeout((()=>{orderFormModal.classList.remove("active"),document.body.style.overflow=""}),1800))},orderName.oninput=saveOrderForm,orderPhone.oninput=saveOrderForm,orderAddress.oninput=saveOrderForm;let mouseDownOutside=!1,mouseUpOutside=!1;const cartModal=document.getElementById("cart-modal");function isOutsideAll(e){return!cartModal.contains(e)&&!productModal.contains(e)&&!orderFormModal.contains(e)}document.addEventListener("mousedown",(e=>{mouseDownOutside=isOutsideAll(e.target)})),document.addEventListener("mouseup",(e=>{mouseUpOutside=isOutsideAll(e.target),mouseDownOutside&&mouseUpOutside&&(cartModal.classList.contains("active")&&(cartModal.classList.remove("active"),document.body.style.overflow=""),productModal.classList.contains("active")&&(productModal.classList.remove("active"),document.body.style.overflow=""),orderFormModal.classList.contains("active")&&(orderFormModal.classList.remove("active"),document.body.style.overflow="")),mouseDownOutside=!1,mouseUpOutside=!1})),document.querySelectorAll("#faq .faq-question").forEach((e=>{e.addEventListener("click",(()=>{e.parentElement.classList.toggle("active")})),e.parentElement.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.currentTarget.classList.toggle("active"))}))})),document.querySelectorAll('#category-filter input[type="radio"]').forEach((e=>{e.addEventListener("change",(function(){const e=this.value;document.querySelectorAll(".item").forEach((t=>{t.dataset.category===e?t.classList.add("show"):t.classList.remove("show")}))}))})),window.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".item").forEach((e=>{"burgers"===e.dataset.category?e.classList.add("show"):e.classList.remove("show")})),document.getElementById("cat-burgers").checked=!0,loadCart(),loadOrderForm()}));